<!-- Used for adding a new Question in database -->


<%- include('../partials/header'); -%>

<div class="loader hidden">
  <img src="/Rolling.gif" alt="Loading..." />
</div>

<div class="container">
  <div class="addQuestion">
    <form action="/UpdateQuestionList" class="AskQuestion">
      <h2><i class="fas fa-question-circle"></i> Post a New Question</h2>
      
      <div class="form-group">
        <label for="topic">Topic</label>
        <input type="text" name="topic" id="topic" placeholder="Write the topic related to your question" required />
        <div class="topic error"></div>
      </div>
      
      <div class="form-group">
        <label for="query">Question</label>
        <textarea name="query" id="query" rows="6" placeholder="What is your question? Please provide details..." required></textarea>
      </div>
      
      <button type="submit" class="btn btn-lg w-full">
        <i class="fas fa-paper-plane"></i> Submit Question
      </button>
    </form>
  </div>
</div>

<script>
  const form = document.querySelector("form");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    //spinner activated
    const loader = document.querySelector(".loader");
    loader.className = "loader";

    //get values of Topic and content of question
    const topic = form.topic.value;
    const problem = form.query.value;
    try {
      const res = await fetch("/UpdateQuestionList", {
        method: "POST",
        body: JSON.stringify({ problem, topic }),
        headers: { "Content-Type": "application/json" },
      });
      const data = await res.json();
      
      if (data.questionID) {
        location.assign(`/questions/${data.questionID}`);
      }
      res.redirect('/smoothies');
      form.submit();
    } catch (err) {
      console.log(err);
    }
  });
</script>

<%- include('../partials/footer'); -%>