<%- include('partials/header'); -%>

<div class="loader hidden">
  <img src="/Rolling.gif" alt="Loading..." />
</div>

<div class="container">
  <div class="wrapper ask-question-wrapper">
    <a href="/UpdateQuestionList" class="btn btn-lg">
      <i class="fas fa-plus"></i> Ask Question
    </a>
  </div>

  <div class="recipes">
    <% question.forEach(function(q) { %>
    <div class="recipe">
      <img src="/logo4.png" alt="Question icon" />
      <h4><%= q.title %></h4>
      <div class="simple">
        <a href="/questions/<%= q._id %>" class="btn">
          <i class="fas fa-eye"></i> View Details
        </a>
        <%if(user && q.author.id.equals(user._id)){%>
        <button type="button" class="btn btn-danger btn-sm" onclick="doDelete('<%= q._id %>');">
          <i class="fas fa-trash"></i>
        </button>
        <%}%>
      </div>
    </div>
    <% }); %>
  </div>
</div>

<script>
  async function doDelete(questionID) {
    const loader = document.querySelector(".loader");
    loader.className = "loader";
    try {
      const res = await fetch("/question/delete", {
        method: "POST",
        body: JSON.stringify({ questionID }),
        headers: { "Content-Type": "application/json" },
      });
      const data = await res.json();
      if (data.msg === "success") {
        location.assign("/smoothies");
      }
    } catch (err) {
      console.log(err);
    }
  }
</script>

<%- include('partials/footer'); -%>
